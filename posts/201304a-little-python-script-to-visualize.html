<html><body><p>A little python script to visualize the quality of dsl tones from zyxel routers. Tested with O² DSL &amp; Comfort (FW  RAS version: V3.40(AOF.5)D0 | 19.03.2009). Should work for all routers that supports wan adsl linedata {fear|near}.<br><br></p><div class="highlight"><pre></pre><pre><span class="c"><span> </span></span></pre><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-LKk7c6LsBRA/UV4OxEpd7VI/AAAAAAAAD-M/v2nBedVdFA4/s1600/test.png" style="margin-left: auto; margin-right: auto;"><img border="0" height="301" src="http://1.bp.blogspot.com/-LKk7c6LsBRA/UV4OxEpd7VI/AAAAAAAAD-M/v2nBedVdFA4/s400/test.png" width="400"></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Example from my adsl line.</td></tr></tbody></table><pre><span class="c"><span> </span></span></pre><pre><span class="c"> </span></pre><pre><span class="c">#!/usr/bin/python</span><br><br><span class="kn">from</span> <span class="nn">pexpect</span> <span class="kn">import</span> <span class="n">spawn</span><span class="p">,</span><span class="n">EOF</span><br><span class="kn">import</span> <span class="nn">sys</span><br><span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span><br><br><span class="n">ADDR</span> <span class="o">=</span> <span class="s">"192.168.2.1"</span><br><span class="n">PASS</span> <span class="o">=</span> <span class="s">"xxxxxxx"</span> #&lt;- here password<br><br><span class="c">#retrieve values via telnet</span><br><span class="n">telnet</span> <span class="o">=</span> <span class="n">spawn</span><span class="p">(</span><span class="s">'telnet </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">ADDR</span><span class="p">)</span><br><br><span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">': '</span><span class="p">)</span><br><span class="n">telnet</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span><br><span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">': '</span><span class="p">)</span><br><span class="n">telnet</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">PASS</span><span class="p">)</span><br><br><span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">'ras&gt; '</span><span class="p">)</span><br><span class="n">UP</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span><br><span class="n">telnet</span><span class="o">.</span><span class="n">logfile_read</span> <span class="o">=</span> <span class="n">UP</span><br><span class="n">telnet</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">'wan adsl linedata far'</span><span class="p">)</span><br><span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">'ras&gt; '</span><span class="p">)</span><br><br><span class="n">DOWN</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span><br><span class="n">telnet</span><span class="o">.</span><span class="n">logfile_read</span> <span class="o">=</span> <span class="n">DOWN</span><br><span class="n">telnet</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">'wan adsl linedata near'</span><span class="p">)</span><br><span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">'ras&gt; '</span><span class="p">)</span><br><span class="n">telnet</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">'exit'</span><span class="p">)</span><br><span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">EOF</span><span class="p">)</span><br><br><span class="n">UP</span><span class="p">,</span><span class="n">DOWN</span> <span class="o">=</span> <span class="n">UP</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">DOWN</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><br><br><span class="k">def</span> <span class="nf">parse_data_array</span><span class="p">(</span><span class="n">string</span><span class="p">):</span><br><span class="n">array</span> <span class="o">=</span> <span class="p">[]</span><br><span class="n">useableChars</span> <span class="o">=</span> <span class="s">'0123456789abcdef'</span><br><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">):</span><br><span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'tone'</span><span class="p">):</span><br><span class="n">pos</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">':'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><br><span class="n">rest</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>            <br><span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rest</span><span class="p">:</span><br><span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">useableChars</span><span class="p">:</span><br><span class="n">array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span><br><span class="k">return</span> <span class="n">array</span><br><br><br><span class="n">dup</span> <span class="o">=</span> <span class="n">parse_data_array</span><span class="p">(</span><span class="n">UP</span><span class="p">)</span><br><span class="n">ddown</span> <span class="o">=</span> <span class="n">parse_data_array</span><span class="p">(</span><span class="n">DOWN</span><span class="p">)</span><br><br><span class="c">#</span><br><span class="nb">all</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dup</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ddown</span><span class="p">)</span> <br><span class="nb">max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ddown</span><span class="p">)</span><span class="o">*</span><span class="mf">15.0</span><br><span class="k">print</span><span class="p">(</span><span class="nb">all</span><span class="o">/</span><span class="nb">max</span><span class="p">)</span><br><br><span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="o">*</span><br><br><span class="n">TONE_WIDTH</span> <span class="o">=</span> <span class="mf">4.3125</span> <span class="c">#kHz</span><br><span class="n">x_axis</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">TONE_WIDTH</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dup</span><span class="p">))]</span><br><br><span class="n">pup</span>   <span class="o">=</span> <span class="n">bar</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">dup</span><span class="p">,</span>   <span class="n">TONE_WIDTH</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'r'</span> <span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><br><span class="n">pdown</span> <span class="o">=</span> <span class="n">bar</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">ddown</span><span class="p">,</span> <span class="n">TONE_WIDTH</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'b'</span> <span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><br><br><span class="n">title</span><span class="p">(</span><span class="s">'DSL tones'</span><span class="p">)</span><br><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span><br><span class="n">ylabel</span><span class="p">(</span><span class="s">"Bit/chan"</span><span class="p">)</span><br><span class="n">xlabel</span><span class="p">(</span><span class="s">"freq [kHz]"</span><span class="p">)</span><br><span class="n">legend</span><span class="p">(</span> <span class="p">(</span><span class="n">pup</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pdown</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="s">'Up'</span><span class="p">,</span> <span class="s">'Down'</span><span class="p">))</span><br><span class="n">show</span><span class="p">()</span><br></pre></div><br></body></html>