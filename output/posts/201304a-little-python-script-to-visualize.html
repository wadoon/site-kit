<!DOCTYPE html><html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="Alexander Weigl">
    <title>Visalizing DSL tones | weigl::io</title>
    
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
      Macros: {
            RR: "{\\mathbf{R}}",
	    br: "&",
            bold: ["{\\bf #1}",1]
      }
  }
});


MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,        
    },
    displayAlign: 'center', // Change this to 'center' to center equations.
    asciimath2jax: {
         delimiters: [[ '``', '``']]     
    },
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script>

        <link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/code.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
            <link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">

    



    
 <link rel="stylesheet" type="text/css" href="../assets/css/tipuesearch.css">
 </head><body><div id="tipue_search_content" style="margin-left: auto; margin-right: auto; padding: 20px;"></div>
 



    <!--Sidebar content-->
    <ul id="sidebar">
    
                <li><a href="../archive.html">Archives</a>
                </li><li><a href="../categories/index.html">Tags</a>
                </li><li><a href="../rss.xml">RSS</a>

    </li><li>
 <span class="navbar-form pull-left">
 <input placeholder="Search" type="text" id="tipue_search_input">
 </span></li>
    </ul>


    <h1 id="blog-title">
        <a href="../" title="weigl::io">weigl::io</a>
    </h1>
		
		<!--	 -->

    
    <div class="postbox">
    
    <h1>Visalizing DSL tones</h1>

    <hr>
    <small>
        Posted: <time class="published" datetime="2012-05-01T00:00:00">2012-05-01 00:00</time>
        

		

          |  
		
			<a href="201304a-little-python-script-to-visualize.md" id="sourcelink">Source</a>
		
    </small>
    <hr>
    <p>A little python script to visualize the quality of dsl tones from zyxel routers.
Tested with O² DSL &amp; Comfort (FW  RAS version: V3.40(AOF.5)D0 | 19.03.2009).
Should work for all routers that supports wan adsl linedata {fear|near}.</p>
<p><a href="http://1.bp.blogspot.com/-LKk7c6LsBRA/UV4OxEpd7VI/AAAAAAAAD-M/v2nBedVdFA4/s1600/test.png" style="margin-left: auto; margin-right: auto;"><img border="0" height="301" src="http://1.bp.blogspot.com/-LKk7c6LsBRA/UV4OxEpd7VI/AAAAAAAAD-M/v2nBedVdFA4/s400/test.png" width="400"></a></p>
<div class="code"><pre><span class="c">#!/usr/bin/python</span>

<span class="kn">from</span> <span class="nn">pexpect</span> <span class="kn">import</span> <span class="n">spawn</span><span class="p">,</span><span class="n">EOF</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">StringIO</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="n">ADDR</span> <span class="o">=</span> <span class="s">"192.168.2.1"</span>
<span class="n">PASS</span> <span class="o">=</span> <span class="s">"xxxxxxx"</span> <span class="c">#&lt;- here password</span>

<span class="c">#retrieve values via telnet</span>
<span class="n">telnet</span> <span class="o">=</span> <span class="n">spawn</span><span class="p">(</span><span class="s">'telnet </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">ADDR</span><span class="p">)</span>

<span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">': '</span><span class="p">)</span>
<span class="n">telnet</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">'admin'</span><span class="p">)</span>
<span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">': '</span><span class="p">)</span>
<span class="n">telnet</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">PASS</span><span class="p">)</span>

<span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">'ras&gt; '</span><span class="p">)</span>
<span class="n">UP</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<span class="n">telnet</span><span class="o">.</span><span class="n">logfile_read</span> <span class="o">=</span> <span class="n">UP</span>
<span class="n">telnet</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">'wan adsl linedata far'</span><span class="p">)</span>
<span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">'ras&gt; '</span><span class="p">)</span>

<span class="n">DOWN</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
<span class="n">telnet</span><span class="o">.</span><span class="n">logfile_read</span> <span class="o">=</span> <span class="n">DOWN</span>
<span class="n">telnet</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">'wan adsl linedata near'</span><span class="p">)</span>
<span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s">'ras&gt; '</span><span class="p">)</span>
<span class="n">telnet</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">'exit'</span><span class="p">)</span>
<span class="n">telnet</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">EOF</span><span class="p">)</span>

<span class="n">UP</span><span class="p">,</span><span class="n">DOWN</span> <span class="o">=</span> <span class="n">UP</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span> <span class="n">DOWN</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">parse_data_array</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">useableChars</span> <span class="o">=</span> <span class="s">'0123456789abcdef'</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">):</span>
       <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">'tone'</span><span class="p">):</span>
         <span class="n">pos</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">':'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
         <span class="n">rest</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">pos</span><span class="p">:]</span>            
         <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rest</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">useableChars</span><span class="p">:</span>
             <span class="n">array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
     <span class="k">return</span> <span class="n">array</span>


<span class="n">dup</span> <span class="o">=</span> <span class="n">parse_data_array</span><span class="p">(</span><span class="n">UP</span><span class="p">)</span>
<span class="n">ddown</span> <span class="o">=</span> <span class="n">parse_data_array</span><span class="p">(</span><span class="n">DOWN</span><span class="p">)</span>


<span class="nb">all</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">dup</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ddown</span><span class="p">)</span> 
<span class="nb">max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ddown</span><span class="p">)</span><span class="mf">15.0</span>
<span class="k">print</span><span class="p">(</span><span class="nb">all</span><span class="o">/</span><span class="nb">max</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span>

<span class="n">TONE_WIDTH</span> <span class="o">=</span> <span class="mf">4.3125</span> <span class="c">#kHz</span>
<span class="n">x_axis</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">TONE_WIDTH</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dup</span><span class="p">))]</span>

<span class="n">pup</span>   <span class="o">=</span> <span class="n">bar</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">dup</span><span class="p">,</span>   <span class="n">TONE_WIDTH</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'r'</span> <span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pdown</span> <span class="o">=</span> <span class="n">bar</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">ddown</span><span class="p">,</span> <span class="n">TONE_WIDTH</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'b'</span> <span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">title</span><span class="p">(</span><span class="s">'DSL tones'</span><span class="p">)</span>
<span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">"Bit/chan"</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">"freq [kHz]"</span><span class="p">)</span>
<span class="n">legend</span><span class="p">(</span> <span class="p">(</span><span class="n">pup</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pdown</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="s">'Up'</span><span class="p">,</span> <span class="s">'Down'</span><span class="p">))</span>
<span class="n">show</span><span class="p">()</span>
</pre></div>
    
    <ul class="pager">
        <li class="previous">
            <a href="../stories/tla.html">← Previous post</a>
        </li>
        <li class="next">
            <a href="201205now-my-latexmkrc-ist-complete-for-my.html">Next post →</a>
        </li>
    </ul>

    

    </div>

    <small>Contents © 2013         <a href="mailto:uiduw@student.kit.edu">Alexander Weigl</a></small>
    

    
    
 <script type="text/javascript" src="../assets/js/tipuesearch_set.js"></script>
 <script type="text/javascript" src="../assets/js/tipuesearch.js"></script>
 <script type="text/javascript">
 $(document).ready(function() {
     $('#tipue_search_input').tipuesearch({
         'mode': 'json',
         'contentLocation': '/assets/js/tipuesearch_content.json',
         'showUrl': false
     });
 });
</script>


</body></html>