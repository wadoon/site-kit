<!DOCTYPE html><html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="Alexander Weigl">
    <title>Organizing Music | weigl::io</title>
    
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
      Macros: {
            RR: "{\\mathbf{R}}",
	    br: "&",
            bold: ["{\\bf #1}",1]
      }
  }
});


MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,        
    },
    displayAlign: 'center', // Change this to 'center' to center equations.
    asciimath2jax: {
         delimiters: [[ '``', '``']]     
    },
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script>

        <link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/code.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
            <link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">

    



    
 <link rel="stylesheet" type="text/css" href="../assets/css/tipuesearch.css">
 </head><body><div id="tipue_search_content" style="margin-left: auto; margin-right: auto; padding: 20px;"></div>
 



    <!--Sidebar content-->
    <ul id="sidebar">
    
                <li><a href="../archive.html">Archives</a>
                </li><li><a href="../categories/index.html">Tags</a>
                </li><li><a href="../rss.xml">RSS</a>

    </li><li>
 <span class="navbar-form pull-left">
 <input placeholder="Search" type="text" id="tipue_search_input">
 </span></li>
    </ul>


    <h1 id="blog-title">
        <a href="../" title="weigl::io">weigl::io</a>
    </h1>
		
		<!--	 -->

    
    <div class="postbox">
    
    <h1>Organizing Music</h1>

    <hr>
    <small>
        Posted: <time class="published" datetime="2012-10-01T00:00:00">2012-10-01 00:00</time>
        

		

          |  
		
			<a href="201210organizing-musc.md" id="sourcelink">Source</a>
		
    </small>
    <hr>
    <p>Do want to reorganize your music collection, but Amarok or other players are to
hard wired? I got this problem with LP from different artists, that would be
spread other the whole collection. So here is a little script for reorganizing
music collection, based on the database written by rhythmbox.</p>
<p>It tries to determine, if an album is a anthology of different artists and put this in:</p>
<blockquote>
<p>$music/<album>/$track - $artist - $album - $title.$suffix</album></p>
</blockquote>
<p>rather than albums from one artists:</p>
<blockquote>
<p>$music/&lt;artist&gt;/<album>/$track - $artist - $album - $title.$suffix</album></p>
</blockquote>
<p>Feel free to modify. This version do not copy or move the files. It creates hard links.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115</pre></div></td><td class="code"><div class="code"><pre><span class="c">#!/usr/bin/python3</span>
<span class="c"># -*- encoding: utf-8 -*-</span>

<span class="n">__author__</span>  <span class="o">=</span> <span class="s">"Alexander Weigl &lt;alexweigl@gmail.com&gt;"</span>

<span class="n">__license__</span> <span class="o">=</span> <span class="s">"cc-by-sa 3.0"</span>
<span class="n">__date__</span>    <span class="o">=</span> <span class="s">"2012-10-02"</span>

<span class="kn">import</span> <span class="nn">os</span> <span class="o">,</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">string</span> <span class="k">import</span> <span class="n">Template</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="k">import</span> <span class="n">unquote</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="k">import</span> <span class="n">etree</span>

<span class="n">PREFIX</span> <span class="o">=</span> <span class="s">"file://"</span>
<span class="n">RHYTHMDB</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">"~/.local/share/rhythmbox/rhythmdb.xml"</span><span class="p">)</span>
<span class="n">MUSIC_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">"~/tmp/musc"</span><span class="p">)</span>
<span class="n">TEMPLATE</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="s">"$track - $artist - $album - $title.$suffix"</span><span class="p">)</span>
<span class="n">VERBOSE</span> <span class="o">=</span> <span class="k">True</span>

<span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
<span class="sd">"""</span>
<span class="sd">    save wrapper for os.mkdir</span>
<span class="sd">"""</span>
<span class="k">try</span><span class="p">:</span> 
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="k">return</span>

<span class="n">COUNTER</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="n">old</span><span class="p">,</span><span class="n">new</span><span class="p">):</span>
<span class="s">"wrapper for os.link"</span>
<span class="k">global</span> <span class="n">COUNTER</span>
<span class="k">try</span><span class="p">:</span>
<span class="k">if</span> <span class="n">VERBOSE</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s">"Link '%s' to '%s'"</span> <span class="o">%</span><span class="p">(</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">))</span> 
        <span class="n">os</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">old</span><span class="p">,</span><span class="n">new</span><span class="p">)</span>
        <span class="n">COUNTER</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="c">#print(e)</span>
<span class="k">pass</span>


<span class="k">def</span> <span class="nf">entry_to_dict</span><span class="p">(</span><span class="n">lis</span><span class="p">):</span>
<span class="s">"translate an enty from rhymthmdb to a dictionary"</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">lis</span><span class="p">:</span>
        <span class="n">d</span><span class="p">[</span><span class="n">ele</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">ele</span><span class="o">.</span><span class="n">text</span>

    <span class="n">d</span><span class="p">[</span><span class="s">'album'</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Unbekannt "</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s">'album'</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="k">None</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="s">'album'</span><span class="p">]</span>
    <span class="n">d</span><span class="p">[</span><span class="s">'file'</span><span class="p">]</span> <span class="o">=</span> <span class="n">unquote</span><span class="p">(</span> <span class="n">d</span><span class="p">[</span><span class="s">'location'</span><span class="p">][</span><span class="nb">len</span><span class="p">(</span><span class="n">PREFIX</span><span class="p">):]</span> <span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s">'track'</span><span class="p">]</span> <span class="o">=</span> <span class="s">"%02d"</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'track-number'</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="c">#for templating</span>
    <span class="n">d</span><span class="p">[</span><span class="s">'suffix'</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s">'file'</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span>
<span class="k">return</span> <span class="n">d</span>

<span class="k">def</span> <span class="nf">format_song</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="s">"return the filename for the given song"</span>
<span class="k">return</span> <span class="n">TEMPLATE</span><span class="o">.</span><span class="n">substitute</span><span class="p">(</span><span class="o">**</span><span class="n">s</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">handleCollection</span><span class="p">(</span><span class="n">album</span><span class="p">,</span> <span class="n">songs</span><span class="p">):</span>
<span class="s">"handle the complete collection"</span>
    <span class="n">albumRoot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MUSIC_PATH</span><span class="p">,</span> <span class="n">album</span><span class="p">)</span>
    <span class="n">mkdir</span><span class="p">(</span><span class="n">albumRoot</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">songs</span><span class="p">:</span>
        <span class="n">new</span>  <span class="o">=</span>   <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">albumRoot</span><span class="p">,</span> <span class="n">format_song</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="n">old</span>  <span class="o">=</span>   <span class="n">s</span><span class="p">[</span><span class="s">"file"</span><span class="p">]</span>        
        <span class="n">link</span><span class="p">(</span><span class="n">old</span><span class="p">,</span><span class="n">new</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">handleNormalAlbum</span><span class="p">(</span><span class="n">album</span><span class="p">,</span><span class="n">songs</span><span class="p">):</span>
    <span class="s">"handle the complete album"</span>
    <span class="n">artist</span> <span class="o">=</span> <span class="n">songs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">"artist"</span><span class="p">]</span>
    <span class="n">albumRoot</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">MUSIC_PATH</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span> <span class="n">album</span><span class="p">)</span>
    <span class="n">mkdir</span><span class="p">(</span><span class="n">albumRoot</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">songs</span><span class="p">:</span>
        <span class="n">new</span>  <span class="o">=</span>   <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">albumRoot</span><span class="p">,</span> <span class="n">format_song</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
        <span class="n">old</span>  <span class="o">=</span>   <span class="n">s</span><span class="p">[</span><span class="s">"file"</span><span class="p">]</span>
        <span class="n">link</span><span class="p">(</span><span class="n">old</span><span class="p">,</span><span class="n">new</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">is_collection</span><span class="p">(</span><span class="n">songs</span><span class="p">):</span>
    <span class="s">"True iff. the songs belong to a collection iff. the artists are different"</span>
    <span class="n">artists</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="s">"artist"</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">songs</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">artists</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">artists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">artists</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="k">True</span>
    <span class="k">return</span> <span class="k">False</span>


<span class="nb">print</span><span class="p">(</span><span class="s">"Reading %s"</span> <span class="o">%</span> <span class="n">RHYTHMDB</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">RHYTHMDB</span><span class="p">)</span>

<span class="n">ALBUM</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="c">#build up album index</span>
<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span><span class="o">.</span><span class="n">getchildren</span><span class="p">():</span>
    <span class="n">song</span> <span class="o">=</span> <span class="n">entry_to_dict</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
        <span class="n">ALBUM</span><span class="p">[</span><span class="n">song</span><span class="p">[</span><span class="s">"album"</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">song</span> <span class="p">)</span>
<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">ALBUM</span><span class="p">[</span><span class="n">song</span><span class="p">[</span><span class="s">"album"</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">song</span> <span class="p">]</span>


<span class="n">mkdir</span><span class="p">(</span><span class="n">MUSIC_PATH</span><span class="p">)</span>

<span class="c">#for each album, handle it appropriate</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ALBUM</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="n">songs</span> <span class="o">=</span> <span class="n">ALBUM</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="k">if</span> <span class="n">is_collection</span><span class="p">(</span><span class="n">songs</span><span class="p">):</span>
        <span class="n">handleCollection</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">songs</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">handleNormalAlbum</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">songs</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s">"Linked %d files"</span> <span class="o">%</span> <span class="n">COUNTER</span><span class="p">)</span>
</pre></div>
</td></tr></table>
    
    <ul class="pager">
        <li class="previous">
            <a href="201207latex-flow.html">← Previous post</a>
        </li>
        <li class="next">
            <a href="201210craigsche-interpolationslemma.html">Next post →</a>
        </li>
    </ul>

    

    </div>

    <small>Contents © 2013         <a href="mailto:uiduw@student.kit.edu">Alexander Weigl</a></small>
    

    
    
 <script type="text/javascript" src="../assets/js/tipuesearch_set.js"></script>
 <script type="text/javascript" src="../assets/js/tipuesearch.js"></script>
 <script type="text/javascript">
 $(document).ready(function() {
     $('#tipue_search_input').tipuesearch({
         'mode': 'json',
         'contentLocation': '/assets/js/tipuesearch_content.json',
         'showUrl': false
     });
 });
</script>


</body></html>